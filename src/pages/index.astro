---
import BaseLayout from '../layouts/BaseLayout.astro';
import ArticleCard from '../components/ArticleCard.astro';
import { getCollection } from 'astro:content';

const latestArticles = (await getCollection('articles'))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 6);
---

<BaseLayout title="Sua dose di√°ria de IA">
  <!-- Hero -->
  <section class="bg-gradient-to-br from-dark via-darker to-dark text-white py-16 md:py-24">
    <div class="max-w-4xl mx-auto px-4 text-center">
      <h1 class="text-4xl md:text-5xl font-bold mb-6">
        Sua dose di√°ria de <span class="text-primary">intelig√™ncia artificial</span>
      </h1>
      <p class="text-xl text-gray-300 mb-8 max-w-2xl mx-auto">
        Not√≠cias, papers e ferramentas de IA ‚Äî curados, traduzidos e explicados em portugu√™s.
        Direto no seu email, todo dia √†s 7h.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a href="#newsletter" class="bg-primary hover:bg-purple-600 text-white font-semibold px-8 py-4 rounded-lg transition text-lg">
          Assinar Gr√°tis
        </a>
        <a href="/artigos" class="bg-white/10 hover:bg-white/20 text-white font-semibold px-8 py-4 rounded-lg transition text-lg">
          Ver Artigos
        </a>
      </div>
    </div>
  </section>

  <!-- Latest Articles -->
  <section class="max-w-4xl mx-auto px-4 py-16">
    <div class="flex items-center justify-between mb-8">
      <h2 class="text-2xl font-bold text-gray-900">√öltimos Artigos</h2>
      <a href="/artigos" class="text-primary hover:underline font-medium">
        Ver todos ‚Üí
      </a>
    </div>

    {latestArticles.length === 0 ? (
      <div class="text-center py-12 bg-gray-50 rounded-xl">
        <p class="text-gray-500 text-lg">Os primeiros artigos ser√£o publicados em breve!</p>
      </div>
    ) : (
      <div class="grid md:grid-cols-2 gap-6">
        {latestArticles.map((article) => (
          <ArticleCard article={article} />
        ))}
      </div>
    )}
  </section>

  <!-- Newsletter Section -->
  <section id="newsletter" class="bg-gray-100 py-16">
    <div class="max-w-xl mx-auto px-4 text-center">
      <h2 class="text-3xl font-bold text-gray-900 mb-4">
        Receba o AI Digest no seu email
      </h2>
      <p class="text-gray-600 mb-8">
        Todo dia √†s 7h, um resumo das principais novidades de IA ‚Äî traduzido e explicado.
      </p>

      <form id="newsletter-form" class="flex flex-col sm:flex-row gap-3">
        <input
          type="email"
          name="email"
          placeholder="seu@email.com"
          required
          class="flex-1 px-4 py-3 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition"
        />
        <button
          type="submit"
          class="bg-primary hover:bg-purple-600 text-white font-semibold px-6 py-3 rounded-lg transition"
        >
          Assinar
        </button>
      </form>

      <p class="text-sm text-gray-500 mt-4">
        Gr√°tis. Cancele quando quiser. Sem spam.
      </p>
    </div>
  </section>

  <!-- Features -->
  <section class="max-w-4xl mx-auto px-4 py-16">
    <h2 class="text-2xl font-bold text-gray-900 text-center mb-12">
      Por que assinar o AI Digest?
    </h2>

    <div class="grid md:grid-cols-3 gap-8">
      <div class="text-center">
        <div class="text-4xl mb-4">üáßüá∑</div>
        <h3 class="font-semibold text-lg mb-2">100% em Portugu√™s</h3>
        <p class="text-gray-600 text-sm">
          Papers e not√≠cias traduzidos e explicados para voc√™ entender de verdade.
        </p>
      </div>

      <div class="text-center">
        <div class="text-4xl mb-4">üéØ</div>
        <h3 class="font-semibold text-lg mb-2">Curadoria Inteligente</h3>
        <p class="text-gray-600 text-sm">
          IA filtra o ru√≠do e entrega s√≥ o que importa para profissionais de tecnologia.
        </p>
      </div>

      <div class="text-center">
        <div class="text-4xl mb-4">‚è∞</div>
        <h3 class="font-semibold text-lg mb-2">5 minutos por dia</h3>
        <p class="text-gray-600 text-sm">
          Leitura r√°pida no caf√© da manh√£. Fique atualizado sem perder tempo.
        </p>
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  const form = document.getElementById('newsletter-form');
  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = new FormData(form as HTMLFormElement).get('email');

    try {
      const res = await fetch('https://yvhtpboejndktqoxbnbn.supabase.co/rest/v1/ai_digest_subscribers', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl2aHRwYm9lam5ka3Rxb3hibmJuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMzYyMDMsImV4cCI6MjA3ODgxMjIwM30.M6PxISn2BjdJRRcsJoRQBVcVL4kjTGuQN53c98BbqSc',
        },
        body: JSON.stringify({ email }),
      });

      if (res.ok) {
        alert('Inscri√ß√£o confirmada! Bem-vindo ao AI Digest üéâ');
        (form as HTMLFormElement).reset();
      } else {
        throw new Error('Erro ao inscrever');
      }
    } catch (err) {
      alert('Erro ao inscrever. Tente novamente.');
    }
  });
</script>
